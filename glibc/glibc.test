#!/bin/bash

# A test runner to be used with glibc.  From the glibc directory run:
#  glibc.test <subdir>
#
# This will run 'make check' with the correct arguments to run glibc
# tests as requested.  The SUBDIR argument is optional and will be used
# to limit tests to run only for the selected sub-directory.

set -x

DIR=`dirname $0`
source $DIR/glibc.config

subdir=$1; shift

pushd $BUILDDIR/build-glibc
    if [ -z "$subdir" ] ; then
        make -r PARALLELMFLAGS="-j4" \
test-wrapper=$DIR/qemu-or1k-libc check
    else
        make -r PARALLELMFLAGS="-j4" -C $BUILDDIR/glibc/$subdir \
test-wrapper=$DIR/qemu-or1k-libc objdir=`pwd` check
    fi
popd

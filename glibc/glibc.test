#!/bin/bash

# A test runner to be used with glibc.  From the glibc directory run:
#  glibc.test <subdir>
#
# This will run 'make check' with the correct arguments to run glibc
# tests as requested.  The SUBDIR argument is optional and will be used
# to limit tests to run only for the selected sub-directory.

DIR=`dirname $0`
source $DIR/glibc.config

if [ $# == 1 ] ; then
  subdir=$1; shift
fi

if [ "$CHROOT" ] ; then
  CHROOT="-chroot"
fi

TEST_WRAPPER="$DIR/qemu-or1k-libc${CHROOT}"
TEST_WRAPPER="$(readlink -f $TEST_WRAPPER)"

pushd $BUILDDIR/build-glibc
    if [ -z "$subdir" ] ; then
        make -r PARALLELMFLAGS="-j4" \
test-wrapper=$TEST_WRAPPER check
    else
        make -r PARALLELMFLAGS="-j4" -C $BUILDDIR/glibc/$subdir \
test-wrapper=$TEST_WRAPPER objdir=`pwd` check
    fi
popd
